---
import type { Album } from '../../../scripts/types';
import { Album as AlbumIcon, Disc3, Music, PenTool, Mic, Archive, GitBranch, Package } from '@lucide/astro';
import AlbumArtImage from './AlbumArtImage.astro';
import { getAlbumArtUrl } from '../../lib/albumArt';
import { getTypeColor } from '../../lib/albumTypeStyles';

interface Props {
  album: Album;
  artistSlug: string;
}

const { album, artistSlug } = Astro.props;
const artUrl = getAlbumArtUrl(artistSlug, album.slug);

const badgeClass = getTypeColor(album.type);

const typeIcons: Record<string, any> = {
  album: AlbumIcon,
  ep: Disc3,
  single: Music,
  demo: PenTool,
  live: Mic,
  compilation: Archive,
  split: GitBranch,
  other: Package,
};

const TypeIcon = typeIcons[album.type] ?? typeIcons.other;
---

<a
  href={`/artist/${artistSlug}/${album.slug}`}
  class="group block rounded-lg border border-surface-200 bg-surface-50 p-3 transition-all hover:border-accent/50 hover:bg-surface-100"
>
  <div class="flex gap-3">
    <div class="shrink-0">
      <AlbumArtImage
        src={artUrl}
        alt={album.name}
        size="thumb"
      />
    </div>
    <div class="min-w-0 flex-1">
      <div class="flex items-start gap-2">
        <TypeIcon class="h-5 w-5 text-accent shrink-0 mt-0.5" />
        <h3 class="font-medium text-gray-100 group-hover:text-accent-light transition-colors">{album.name}</h3>
      </div>
      <div class="mt-1 flex flex-wrap items-center gap-2 text-sm text-gray-400">
        {album.year && <span>{album.year}</span>}
        {album.type !== 'album' && (
          <span class={`rounded px-1.5 py-0.5 text-xs font-medium ${badgeClass}`}>
            {album.type.toUpperCase()}
          </span>
        )}
        {album.reissue && (
          <span class="rounded px-1.5 py-0.5 text-xs font-medium bg-yellow-500/20 text-yellow-400">
            {album.reissue}
          </span>
        )}
        {album.hasMultipleDiscs && (
          <span class="text-xs text-gray-500">{album.discCount} discs</span>
        )}
      </div>
    </div>
  </div>
</a>
